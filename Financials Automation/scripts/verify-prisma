#!/usr/bin/env node

import { execSync } from 'child_process';
import fs from 'fs';
import path from 'path';

console.log('üîç Verifying Prisma setup...');

// Check if Prisma schema exists
const schemaPath = path.join(process.cwd(), 'prisma', 'schema.prisma');
if (!fs.existsSync(schemaPath)) {
  console.error('‚ùå Prisma schema not found at prisma/schema.prisma');
  process.exit(1);
}
console.log('‚úÖ Prisma schema found');

// Check if .env file exists and has DATABASE_URL
const envPath = path.join(process.cwd(), '.env');
if (!fs.existsSync(envPath)) {
  console.error('‚ùå .env file not found');
  process.exit(1);
}

const envContent = fs.readFileSync(envPath, 'utf8');
if (!envContent.includes('DATABASE_URL=')) {
  console.error('‚ùå DATABASE_URL not found in .env file');
  process.exit(1);
}
console.log('‚úÖ DATABASE_URL configured');

// Validate Prisma schema
try {
  execSync('prisma validate', { stdio: 'pipe' });
  console.log('‚úÖ Prisma schema is valid');
} catch (error) {
  console.error('‚ùå Prisma schema validation failed:', error.message);
  process.exit(1);
}

// Generate Prisma client
try {
  console.log('üîÑ Generating Prisma client...');
  execSync('prisma generate', { stdio: 'inherit' });
  console.log('‚úÖ Prisma client generated successfully');
} catch (error) {
  console.error('‚ùå Prisma client generation failed:', error.message);
  process.exit(1);
}

// Check if Prisma client files exist (generated in custom location)
const clientPath = path.join(process.cwd(), 'src', 'generated', 'prisma');
if (!fs.existsSync(clientPath)) {
  console.error('‚ùå Prisma client not found in src/generated/prisma');
  process.exit(1);
}
console.log('‚úÖ Prisma client files found');

console.log('üéâ Prisma setup verification completed successfully!');
