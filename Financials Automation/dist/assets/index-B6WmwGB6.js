import{u as U,r as g,z as o,o as q,j as e,s as h,n as p}from"./index-HyfZDTXf.js";import{u as R,L,g as M,d as $,e as v}from"./Layout-tNQcTW0Y.js";import{u as f,a as z,b as H}from"./zod-DIWepabP.js";const Q=q({classOfShare:h().default("Equity Shares"),numberOfShares:h().transform(r=>BigInt(r||"0")),faceValue:p().default(10),amountCY:p().default(0),amountPY:p().default(0),shareholderName:h().optional(),holdingPercentageCY:p().optional(),numberOfSharesPY:h().optional().transform(r=>r?BigInt(r):void 0)});function X(){const r=U(),[b,m]=g.useState(!1),[C,i]=g.useState(!1),[y,n]=g.useState(0),t=R(r.getShareCapitalEntries.queryOptions()),x=f({...r.addShareCapitalEntry.mutationOptions(),onSuccess:()=>{o.success("Share capital entry added successfully!"),t.refetch(),m(!1),N()},onError:s=>{o.error("Failed to add entry: "+s.message)}}),P=f({...r.getShareCapitalUploadUrl.mutationOptions(),onError:s=>{o.error("Failed to get upload URL: "+s.message),i(!1)}}),Y=f({...r.processShareCapitalFile.mutationOptions(),onSuccess:s=>{o.success(`Successfully uploaded ${s.entriesProcessed} share capital entries!`),t.refetch(),i(!1),n(0)},onError:s=>{o.error("Failed to process file: "+s.message),i(!1),n(0)}}),{register:l,handleSubmit:O,reset:N,formState:{errors:u},watch:j}=z({resolver:H(Q),defaultValues:{classOfShare:"Equity Shares",faceValue:10,amountCY:0,amountPY:0}}),E=j("numberOfShares"),F=j("faceValue"),A=async s=>{try{await x.mutateAsync({...s,numberOfShares:BigInt(s.numberOfShares.toString()),numberOfSharesPY:s.numberOfSharesPY?BigInt(s.numberOfSharesPY.toString()):void 0})}catch{}},k=()=>{[{classOfShare:"Equity Shares",numberOfShares:BigInt(1e5),faceValue:10,amountCY:1e6,amountPY:1e6,shareholderName:"Promoters",holdingPercentageCY:60,numberOfSharesPY:BigInt(1e5)},{classOfShare:"Equity Shares",numberOfShares:BigInt(5e4),faceValue:10,amountCY:5e5,amountPY:4e5,shareholderName:"Public",holdingPercentageCY:30,numberOfSharesPY:BigInt(4e4)},{classOfShare:"Preference Shares",numberOfShares:BigInt(1e4),faceValue:100,amountCY:1e6,amountPY:1e6,shareholderName:"Financial Institutions",holdingPercentageCY:10,numberOfSharesPY:BigInt(1e4)}].forEach(async a=>{try{await x.mutateAsync(a)}catch(c){console.error("Failed to add sample data:",c)}})},S=async s=>{if(!s)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(s.type)){o.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}i(!0),n(10);try{const{uploadUrl:c,objectName:T}=await P.mutateAsync({fileName:s.name,fileType:s.type});if(n(30),!(await fetch(c,{method:"PUT",body:s,headers:{"Content-Type":s.type}})).ok)throw new Error("Failed to upload file");n(60),await Y.mutateAsync({objectName:T}),n(100)}catch(c){console.error("Upload error:",c),i(!1),n(0)}},I=s=>{s.preventDefault(),s.stopPropagation()},B=s=>{s.preventDefault(),s.stopPropagation();const a=Array.from(s.dataTransfer.files);a.length>0&&S(a[0])},V=s=>{const a=Array.from(s.target.files||[]);a.length>0&&S(a[0])},d=s=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),w=s=>new Intl.NumberFormat("en-IN").format(Number(s)),D=["Equity Shares","Preference Shares","Cumulative Preference Shares","Non-Cumulative Preference Shares","Redeemable Preference Shares","Convertible Preference Shares"];return e.jsx(L,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"Share Capital Schedule"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage share capital details as per Schedule III requirements"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:k,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>m(!b),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Entry"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),C?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${y}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[y,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:I,onDrop:B,onClick:()=>document.getElementById("share-capital-file-upload")?.click(),children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"share-capital-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:V})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Class of Share, Number of Shares, Face Value, Amount CY, Amount PY, Shareholder Name, Holding %, Number of Shares PY"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:t.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Entries"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"â‚¹"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:d(t.data?.reduce((s,a)=>s+Number(a.amountCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount (CY)"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"#"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:w(t.data?.reduce((s,a)=>s+BigInt(a.numberOfShares),BigInt(0))||BigInt(0))}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Shares"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"C"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Set(t.data?.map(s=>s.classOfShare)).size||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Share Classes"})]})})]})})]}),b&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Share Capital Entry"}),e.jsxs("form",{onSubmit:O(A),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Class of Share *"}),e.jsx("select",{...l("classOfShare"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:D.map(s=>e.jsx("option",{value:s,children:s},s))}),u.classOfShare&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.classOfShare.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Shares (CY) *"}),e.jsx("input",{...l("numberOfShares"),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter number of shares"}),u.numberOfShares&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.numberOfShares.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Face Value per Share"}),e.jsx("input",{...l("faceValue",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Current Year)"}),e.jsx("input",{...l("amountCY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Previous Year)"}),e.jsx("input",{...l("amountPY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Shareholder Name"}),e.jsx("input",{...l("shareholderName"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter shareholder name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Holding Percentage (CY)"}),e.jsx("input",{...l("holdingPercentageCY",{valueAsNumber:!0}),type:"number",step:"0.01",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of Shares (PY)"}),e.jsx("input",{...l("numberOfSharesPY"),type:"text",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter number of shares"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Calculated Amount: ",e.jsxs("strong",{children:["â‚¹",d((Number(E)||0)*(F||0))]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{m(!1),N()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:x.isPending?"Adding...":"Add Entry"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Share Capital Entries"})}),t.data&&t.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Class of Share"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Shareholder"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No. of Shares (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Face Value"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (PY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Holding %"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.data.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:s.classOfShare})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:s.shareholderName||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:w(BigInt(s.numberOfShares))}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",d(Number(s.faceValue))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",d(Number(s.amountCY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",d(Number(s.amountPY))]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:s.holdingPercentageCY?`${s.holdingPercentageCY}%`:"-"})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No share capital data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add entries manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>m(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Entry"})]})]})]})})}export{X as component};
