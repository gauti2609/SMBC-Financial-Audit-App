import{u as D,r as p,z as r,o as O,j as e,n as j,e as U,s as M}from"./index-HyfZDTXf.js";import{u as I,L as R,g as B,d as $,f as N}from"./Layout-tNQcTW0Y.js";import{u as g,a as G,b as q}from"./zod-DIWepabP.js";const z=O({particulars:M().min(1,"Particulars is required"),type:U(["Contingent Liability","Commitment"]),amountCY:j().default(0),amountPY:j().default(0)});function K(){const d=D(),[h,c]=p.useState(!1),[w,l]=p.useState(!1),[b,i]=p.useState(0),a=I(d.getContingentLiabilities.queryOptions()),m=g({...d.addContingentLiability.mutationOptions(),onSuccess:()=>{r.success("Contingent liability entry added successfully!"),a.refetch(),c(!1),y()},onError:t=>{r.error("Failed to add entry: "+t.message)}}),C=g({...d.getContingentLiabilitiesUploadUrl.mutationOptions(),onError:t=>{r.error("Failed to get upload URL: "+t.message),l(!1)}}),v=g({...d.processContingentLiabilitiesFile.mutationOptions(),onSuccess:t=>{r.success(`Successfully uploaded ${t.entriesProcessed} contingent liability entries!`),a.refetch(),l(!1),i(0)},onError:t=>{r.error("Failed to process file: "+t.message),l(!1),i(0)}}),{register:x,handleSubmit:L,reset:y,formState:{errors:u}}=G({resolver:q(z),defaultValues:{type:"Contingent Liability",amountCY:0,amountPY:0}}),P=async t=>{try{await m.mutateAsync(t)}catch{}},Y=()=>{[{particulars:"Claims against the company not acknowledged as debts - Income Tax",type:"Contingent Liability",amountCY:25e5,amountPY:22e5},{particulars:"Bank Guarantees given to customers",type:"Contingent Liability",amountCY:5e6,amountPY:45e5},{particulars:"Letters of Credit issued by banks",type:"Contingent Liability",amountCY:15e5,amountPY:18e5},{particulars:"Capital commitments - Plant and Machinery",type:"Commitment",amountCY:8e6,amountPY:6e6},{particulars:"Lease commitments - Operating lease rentals",type:"Commitment",amountCY:32e5,amountPY:35e5}].forEach(async s=>{try{await m.mutateAsync(s)}catch(o){console.error("Failed to add sample data:",o)}})},f=async t=>{if(!t)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(t.type)){r.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}l(!0),i(10);try{const{uploadUrl:o,objectName:E}=await C.mutateAsync({fileName:t.name,fileType:t.type});if(i(30),!(await fetch(o,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok)throw new Error("Failed to upload file");i(60),await v.mutateAsync({objectName:E}),i(100)}catch(o){console.error("Upload error:",o),l(!1),i(0)}},k=t=>{t.preventDefault(),t.stopPropagation()},F=t=>{t.preventDefault(),t.stopPropagation();const s=Array.from(t.dataTransfer.files);s.length>0&&f(s[0])},A=t=>{const s=Array.from(t.target.files||[]);s.length>0&&f(s[0])},n=t=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),S=["Claims against the company not acknowledged as debts - Income Tax","Claims against the company not acknowledged as debts - Sales Tax","Claims against the company not acknowledged as debts - Excise Duty","Claims against the company not acknowledged as debts - Service Tax","Claims against the company not acknowledged as debts - GST","Claims against the company not acknowledged as debts - Others","Bank Guarantees given to customers","Letters of Credit issued by banks","Bills discounted with banks","Guarantees given on behalf of subsidiaries/associates","Disputed liabilities","Legal cases pending against the company"],T=["Capital commitments - Plant and Machinery","Capital commitments - Buildings","Capital commitments - Intangible assets","Lease commitments - Operating lease rentals","Lease commitments - Finance lease obligations","Purchase commitments - Raw materials","Purchase commitments - Capital goods","Contract commitments - Construction contracts","Investment commitments","Other commitments"];return e.jsx(R,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"Contingent Liabilities & Commitments"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage contingent liabilities and commitments as per AS 29 requirements"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:Y,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>c(!h),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(B,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Entry"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${b}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:k,onDrop:F,onClick:()=>document.getElementById("contingent-liabilities-file-upload")?.click(),children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"contingent-liabilities-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:A})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Particulars, Type (Contingent Liability/Commitment), Amount CY, Amount PY"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:a.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Entries"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"CL"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(a.data?.filter(t=>t.type==="Contingent Liability").reduce((t,s)=>t+Number(s.amountCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Contingent Liabilities"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"CM"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(a.data?.filter(t=>t.type==="Commitment").reduce((t,s)=>t+Number(s.amountCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Commitments"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"â‚¹"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(a.data?.reduce((t,s)=>t+Number(s.amountCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount (CY)"})]})})]})})]}),h&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Entry"}),e.jsxs("form",{onSubmit:L(P),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Particulars *"}),e.jsx("input",{...x("particulars"),list:"liability-options",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter details"}),e.jsx("datalist",{id:"liability-options",children:[...S,...T].map(t=>e.jsx("option",{value:t},t))}),u.particulars&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.particulars.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),e.jsxs("select",{...x("type"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"Contingent Liability",children:"Contingent Liability"}),e.jsx("option",{value:"Commitment",children:"Commitment"})]}),u.type&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.type.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Current Year)"}),e.jsx("input",{...x("amountCY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Previous Year)"}),e.jsx("input",{...x("amountPY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),y()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:m.isPending?"Adding...":"Add Entry"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Contingent Liabilities & Commitments"})}),a.data&&a.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particulars"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (PY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Change"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.data.map(t=>{const s=Number(t.amountCY)-Number(t.amountPY);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900 max-w-xs",children:t.particulars})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.type==="Contingent Liability"?"bg-red-100 text-red-800":"bg-orange-100 text-orange-800"}`,children:t.type})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",n(Number(t.amountCY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",n(Number(t.amountPY))]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-right",children:e.jsxs("span",{className:s>=0?"text-red-600":"text-green-600",children:[s>=0?"+":"","â‚¹",n(Math.abs(s))]})})]},t.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No contingent liabilities or commitments"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add entries manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>c(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Entry"})]})]})]})})}export{K as component};
