import{u as E,r as g,z as d,o as U,j as e,n as p,s as h}from"./index-HyfZDTXf.js";import{u as L,L as M,g as q,d as B,j as v}from"./Layout-tNQcTW0Y.js";import{u as y,a as I,b as K}from"./zod-DIWepabP.js";const $=U({relatedPartyName:h().min(1,"Related party name is required"),relationship:h().min(1,"Relationship is required"),transactionType:h().min(1,"Transaction type is required"),amountCY:p().default(0),amountPY:p().default(0),balanceOutstandingCY:p().default(0),balanceOutstandingPY:p().default(0)});function J(){const m=E(),[b,x]=g.useState(!1),[w,o]=g.useState(!1),[f,r]=g.useState(0),s=L(m.getRelatedPartyTransactions.queryOptions()),u=y({...m.addRelatedPartyTransaction.mutationOptions(),onSuccess:()=>{d.success("Related party transaction added successfully!"),s.refetch(),x(!1),N()},onError:t=>{d.error("Failed to add transaction: "+t.message)}}),P=y({...m.getRelatedPartiesUploadUrl.mutationOptions(),onError:t=>{d.error("Failed to get upload URL: "+t.message),o(!1)}}),Y=y({...m.processRelatedPartiesFile.mutationOptions(),onSuccess:t=>{d.success(`Successfully uploaded ${t.entriesProcessed} related party transactions!`),s.refetch(),o(!1),r(0)},onError:t=>{d.error("Failed to process file: "+t.message),o(!1),r(0)}}),{register:n,handleSubmit:C,reset:N,formState:{errors:l}}=I({resolver:K($),defaultValues:{amountCY:0,amountPY:0,balanceOutstandingCY:0,balanceOutstandingPY:0}}),T=async t=>{try{await u.mutateAsync(t)}catch{}},O=()=>{[{relatedPartyName:"ABC Holdings Pvt Ltd",relationship:"Holding Company",transactionType:"Purchase of goods",amountCY:25e4,amountPY:2e5,balanceOutstandingCY:5e4,balanceOutstandingPY:3e4},{relatedPartyName:"John Doe",relationship:"Key Management Personnel",transactionType:"Remuneration",amountCY:12e5,amountPY:11e5,balanceOutstandingCY:0,balanceOutstandingPY:0},{relatedPartyName:"XYZ Subsidiary Ltd",relationship:"Subsidiary",transactionType:"Sale of services",amountCY:15e4,amountPY:12e4,balanceOutstandingCY:25e3,balanceOutstandingPY:15e3}].forEach(async a=>{try{await u.mutateAsync(a)}catch(c){console.error("Failed to add sample data:",c)}})},j=async t=>{if(!t)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(t.type)){d.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}o(!0),r(10);try{const{uploadUrl:c,objectName:D}=await P.mutateAsync({fileName:t.name,fileType:t.type});if(r(30),!(await fetch(c,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok)throw new Error("Failed to upload file");r(60),await Y.mutateAsync({objectName:D}),r(100)}catch(c){console.error("Upload error:",c),o(!1),r(0)}},A=t=>{t.preventDefault(),t.stopPropagation()},R=t=>{t.preventDefault(),t.stopPropagation();const a=Array.from(t.dataTransfer.files);a.length>0&&j(a[0])},S=t=>{const a=Array.from(t.target.files||[]);a.length>0&&j(a[0])},i=t=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),F=["Holding Company","Subsidiary","Associate Company","Joint Venture","Key Management Personnel","Director","Relative of KMP","Enterprise controlled by KMP"],k=["Purchase of goods","Sale of goods","Purchase of services","Sale of services","Remuneration","Rent paid","Rent received","Interest paid","Interest received","Loans given","Loans taken","Guarantee given","Guarantee received"];return e.jsx(M,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"Related Party Transactions"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage related party transactions as per AS 18 requirements"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:O,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>x(!b),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Transaction"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),w?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${f}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[f,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:A,onDrop:R,onClick:()=>document.getElementById("related-parties-file-upload")?.click(),children:[e.jsx(B,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"related-parties-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:S})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Related Party Name, Relationship, Transaction Type, Amount CY, Amount PY, Outstanding CY, Outstanding PY"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Transactions"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"â‚¹"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i(s.data?.reduce((t,a)=>t+Number(a.amountCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Amount (CY)"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"O"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:i(s.data?.reduce((t,a)=>t+Number(a.balanceOutstandingCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Outstanding (CY)"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"P"})}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:new Set(s.data?.map(t=>t.relatedPartyName)).size||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Unique Parties"})]})})]})})]}),b&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Related Party Transaction"}),e.jsxs("form",{onSubmit:C(T),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Related Party Name *"}),e.jsx("input",{...n("relatedPartyName"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter related party name"}),l.relatedPartyName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.relatedPartyName.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Relationship *"}),e.jsxs("select",{...n("relationship"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select relationship"}),F.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.relationship&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.relationship.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Transaction Type *"}),e.jsxs("select",{...n("transactionType"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select transaction type"}),k.map(t=>e.jsx("option",{value:t,children:t},t))]}),l.transactionType&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.transactionType.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Current Year)"}),e.jsx("input",{...n("amountCY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Previous Year)"}),e.jsx("input",{...n("amountPY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Outstanding Balance (CY)"}),e.jsx("input",{...n("balanceOutstandingCY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Outstanding Balance (PY)"}),e.jsx("input",{...n("balanceOutstandingPY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),N()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:u.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:u.isPending?"Adding...":"Add Transaction"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Related Party Transactions"})}),s.data&&s.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Related Party"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Relationship"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Transaction Type"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount (PY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Outstanding (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Outstanding (PY)"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.data.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.relatedPartyName})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.relationship})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.transactionType}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",i(Number(t.amountCY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",i(Number(t.amountPY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",i(Number(t.balanceOutstandingCY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",i(Number(t.balanceOutstandingPY))]})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No related party transactions"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add transactions manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>x(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Transaction"})]})]})]})})}export{J as component};
