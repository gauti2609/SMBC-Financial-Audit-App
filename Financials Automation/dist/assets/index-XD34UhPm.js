import{u as D,r as p,z as i,o as T,j as e,n as N,e as U,s as O}from"./index-HyfZDTXf.js";import{u as M,L,g as q,d as R,m as j}from"./Layout-tNQcTW0Y.js";import{u as h,a as B,b as $}from"./zod-DIWepabP.js";const V=T({particulars:O().min(1,"Particulars is required"),classification:U(["Current","Non-Current"]),costCY:N().default(0),costPY:N().default(0)});function H(){const d=D(),[g,c]=p.useState(!1),[v,l]=p.useState(!1),[b,a]=p.useState(0),r=M(d.getInvestmentEntries.queryOptions()),m=h({...d.addInvestmentEntry.mutationOptions(),onSuccess:()=>{i.success("Investment entry added successfully!"),r.refetch(),c(!1),f()},onError:s=>{i.error("Failed to add entry: "+s.message)}}),w=h({...d.getInvestmentUploadUrl.mutationOptions(),onError:s=>{i.error("Failed to get upload URL: "+s.message),l(!1)}}),C=h({...d.processInvestmentFile.mutationOptions(),onSuccess:s=>{i.success(`Successfully uploaded ${s.entriesProcessed} investment entries!`),r.refetch(),l(!1),a(0)},onError:s=>{i.error("Failed to process file: "+s.message),l(!1),a(0)}}),{register:x,handleSubmit:I,reset:f,formState:{errors:u}}=B({resolver:$(V),defaultValues:{classification:"Non-Current",costCY:0,costPY:0}}),F=async s=>{try{await m.mutateAsync(s)}catch{}},y=async s=>{if(!s)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(s.type)){i.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}l(!0),a(10);try{const{uploadUrl:o,objectName:k}=await w.mutateAsync({fileName:s.name,fileType:s.type});if(a(30),!(await fetch(o,{method:"PUT",body:s,headers:{"Content-Type":s.type}})).ok)throw new Error("Failed to upload file");a(60),await C.mutateAsync({objectName:k}),a(100)}catch(o){console.error("Upload error:",o),l(!1),a(0)}},P=s=>{s.preventDefault(),s.stopPropagation()},Y=s=>{s.preventDefault(),s.stopPropagation();const t=Array.from(s.dataTransfer.files);t.length>0&&y(t[0])},S=s=>{const t=Array.from(s.target.files||[]);t.length>0&&y(t[0])},E=()=>{[{particulars:"Investment in Equity Shares - ABC Ltd",classification:"Non-Current",costCY:25e5,costPY:25e5},{particulars:"Investment in Mutual Funds - Liquid Fund",classification:"Current",costCY:15e5,costPY:12e5},{particulars:"Investment in Government Securities",classification:"Non-Current",costCY:3e6,costPY:28e5},{particulars:"Fixed Deposits (> 12 months)",classification:"Non-Current",costCY:5e6,costPY:45e5},{particulars:"Investment in Bonds - Corporate",classification:"Current",costCY:8e5,costPY:1e6}].forEach(async t=>{try{await m.mutateAsync(t)}catch(o){console.error("Failed to add sample data:",o)}})},n=s=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),A=["Investment in Equity Shares","Investment in Preference Shares","Investment in Mutual Funds","Investment in Government Securities","Investment in Corporate Bonds","Investment in Debentures","Fixed Deposits","Investment in Subsidiaries","Investment in Associates","Investment in Joint Ventures","Investment in Partnership Firms","Other Investments"];return e.jsx(L,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"Investments Schedule"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage investment details as per AS 13 and Schedule III requirements"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:E,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>c(!g),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Entry"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${b}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[b,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:P,onDrop:Y,onClick:()=>document.getElementById("investment-file-upload")?.click(),children:[e.jsx(R,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"investment-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:S})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Particulars, Classification (Current/Non-Current), Cost CY, Cost PY"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(j,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Investments"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"â‚¹"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.reduce((s,t)=>s+Number(t.costCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Cost (CY)"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"NC"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.filter(s=>s.classification==="Non-Current").reduce((s,t)=>s+Number(t.costCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Non-Current"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"C"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.filter(s=>s.classification==="Current").reduce((s,t)=>s+Number(t.costCY),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Current"})]})})]})})]}),g&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Investment Entry"}),e.jsxs("form",{onSubmit:I(F),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Particulars *"}),e.jsx("input",{...x("particulars"),list:"investment-options",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter investment details"}),e.jsx("datalist",{id:"investment-options",children:A.map(s=>e.jsx("option",{value:s},s))}),u.particulars&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.particulars.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Classification *"}),e.jsxs("select",{...x("classification"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"Current",children:"Current"}),e.jsx("option",{value:"Non-Current",children:"Non-Current"})]}),u.classification&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.classification.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost (Current Year)"}),e.jsx("input",{...x("costCY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost (Previous Year)"}),e.jsx("input",{...x("costPY",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),f()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:m.isPending?"Adding...":"Add Entry"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Investment Entries"})}),r.data&&r.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particulars"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Classification"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost (CY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Cost (PY)"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Change"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.data.map(s=>{const t=Number(s.costCY)-Number(s.costPY);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.particulars})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${s.classification==="Current"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:s.classification})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",n(Number(s.costCY))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["â‚¹",n(Number(s.costPY))]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-right",children:e.jsxs("span",{className:t>=0?"text-green-600":"text-red-600",children:[t>=0?"+":"","â‚¹",n(Math.abs(t))]})})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No investment data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add entries manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>c(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Entry"})]})]})]})})}export{H as component};
