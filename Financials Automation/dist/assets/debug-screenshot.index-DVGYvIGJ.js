import{r as a,u as B,a as W,b as P,j as e,z as m}from"./index-HyfZDTXf.js";import{w as Z,u as R,L as U,v as V,r as q,a as H,f as Q,b as z}from"./Layout-tNQcTW0Y.js";import{F as G}from"./ComputerDesktopIcon-C0apim9b.js";import{F as J}from"./EyeIcon-C-uHLVJa.js";import{F as w}from"./InformationCircleIcon-dadFmOSF.js";import{F as K}from"./ExclamationCircleIcon-0P1XXFZe.js";import"./zod-DIWepabP.js";function X({title:c,titleId:o,...l},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},l),c?a.createElement("title",{id:o},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 12.75c1.148 0 2.278.08 3.383.237 1.037.146 1.866.966 1.866 2.013 0 3.728-2.35 6.75-5.25 6.75S6.75 18.728 6.75 15c0-1.046.83-1.867 1.866-2.013A24.204 24.204 0 0 1 12 12.75Zm0 0c2.883 0 5.647.508 8.207 1.44a23.91 23.91 0 0 1-1.152 6.06M12 12.75c-2.883 0-5.647.508-8.208 1.44.125 2.104.52 4.136 1.153 6.06M12 12.75a2.25 2.25 0 0 0 2.248-2.354M12 12.75a2.25 2.25 0 0 1-2.248-2.354M12 8.25c.995 0 1.971-.08 2.922-.236.403-.066.74-.358.795-.762a3.778 3.778 0 0 0-.399-2.25M12 8.25c-.995 0-1.97-.08-2.922-.236-.402-.066-.74-.358-.795-.762a3.734 3.734 0 0 1 .4-2.253M12 8.25a2.25 2.25 0 0 0-2.248 2.146M12 8.25a2.25 2.25 0 0 1 2.248 2.146M8.683 5a6.032 6.032 0 0 1-1.155-1.002c.07-.63.27-1.222.574-1.747m.581 2.749A3.75 3.75 0 0 1 15.318 5m0 0c.427-.283.815-.62 1.155-.999a4.471 4.471 0 0 0-.575-1.752M4.921 6a24.048 24.048 0 0 0-.392 3.314c1.668.546 3.416.914 5.223 1.082M19.08 6c.205 1.08.337 2.187.392 3.314a23.882 23.882 0 0 1-5.223 1.082"}))}const Y=a.forwardRef(X);function _({title:c,titleId:o,...l},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},l),c?a.createElement("title",{id:o},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"}))}const ee=a.forwardRef(_);function se({title:c,titleId:o,...l},i){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:i,"aria-labelledby":o},l),c?a.createElement("title",{id:o},c):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.348 14.652a3.75 3.75 0 0 1 0-5.304m5.304 0a3.75 3.75 0 0 1 0 5.304m-7.425 2.121a6.75 6.75 0 0 1 0-9.546m9.546 0a6.75 6.75 0 0 1 0 9.546M5.106 18.894c-3.808-3.807-3.808-9.98 0-13.788m13.788 0c3.808 3.807 3.808 9.98 0 13.788M12 12h.008v.008H12V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}const te=a.forwardRef(se);function de(){const c=B(),{isAuthenticated:o,token:l,user:i}=W(),{selectedCompanyId:d}=P(),{isConnected:x,connectionString:b,lastConnectionError:g}=Z(),[p,$]=a.useState([]),[y,j]=a.useState(!1),[h,N]=a.useState(null),[f,v]=a.useState([]),C=R(c.getTrialBalance.queryOptions({companyId:d||""},{enabled:!!d})),S=R(c.getDatabaseConnectionStatus.queryOptions(void 0,{refetchInterval:5e3}));a.useEffect(()=>{const s=console.log,t=console.error,k=console.warn,D=console.info,u=(n,...r)=>{const I=`[${new Date().toLocaleTimeString()}] [${n}] ${r.join(" ")}`;v(O=>[I,...O.slice(0,49)])};return console.log=(...n)=>{s(...n),n.some(r=>typeof r=="string"&&r.includes("Database Connection"))&&u("LOG",...n)},console.error=(...n)=>{t(...n),n.some(r=>typeof r=="string"&&r.includes("Database Connection"))&&u("ERROR",...n)},console.warn=(...n)=>{k(...n),n.some(r=>typeof r=="string"&&r.includes("Database Connection"))&&u("WARN",...n)},console.info=(...n)=>{D(...n),n.some(r=>typeof r=="string"&&r.includes("Database Connection"))&&u("INFO",...n)},()=>{console.log=s,console.error=t,console.warn=k,console.info=D}},[]);const L=async()=>{j(!0);const s=[];try{s.push({name:"Authentication",status:o?"success":"error",message:o?`Authenticated as ${i?.email}`:"Not authenticated",details:l?`Token: ${l.substring(0,20)}...`:"No token available",timestamp:new Date}),s.push({name:"Company Selection",status:d?"success":"warning",message:d?`Company selected: ${d}`:"No company selected",details:d?void 0:"Please select a company to proceed",timestamp:new Date}),s.push({name:"Database Connection",status:x?"success":"error",message:x?`Connected to ${b}`:"Database disconnected",details:g||void 0,timestamp:new Date});try{await S.refetch(),s.push({name:"tRPC Communication",status:"success",message:"tRPC client communication working",details:"Successfully executed database status query",timestamp:new Date})}catch(t){s.push({name:"tRPC Communication",status:"error",message:"tRPC communication failed",details:t instanceof Error?t.message:"Unknown error",timestamp:new Date})}if(d)try{const t=await C.refetch();s.push({name:"Trial Balance Data",status:t.data?.length?"success":"warning",message:t.data?.length?`${t.data.length} entries loaded`:"No trial balance data",details:t.data?.length?void 0:"Upload trial balance to proceed",timestamp:new Date})}catch(t){s.push({name:"Trial Balance Data",status:"error",message:"Failed to load trial balance",details:t instanceof Error?t.message:"Unknown error",timestamp:new Date})}s.push({name:"Browser Environment",status:"info",message:`${navigator.userAgent.split(" ").pop()} on ${navigator.platform}`,details:`Screen: ${screen.width}x${screen.height}, Viewport: ${window.innerWidth}x${window.innerHeight}`,timestamp:new Date});try{localStorage.setItem("debug-test","test"),localStorage.removeItem("debug-test"),s.push({name:"Local Storage",status:"success",message:"Local storage working",details:"Configuration persistence available",timestamp:new Date})}catch{s.push({name:"Local Storage",status:"error",message:"Local storage unavailable",details:"Configuration will not persist",timestamp:new Date})}console.log("Database Connection [test]: Debug system check initiated"),s.push({name:"Console Forwarding",status:"info",message:"Console forwarding active",details:"Client logs are being forwarded to server",timestamp:new Date}),$(s),m.success("System checks completed")}catch(t){console.error("System checks failed:",t),m.error("System checks failed")}finally{j(!1)}},F=async()=>{try{if("html2canvas"in window){const s=await window.html2canvas(document.body);N(s.toDataURL())}else{const s={timestamp:new Date().toISOString(),url:window.location.href,viewport:{width:window.innerWidth,height:window.innerHeight},screen:{width:screen.width,height:screen.height},userAgent:navigator.userAgent};N(`data:text/plain;base64,${btoa(JSON.stringify(s,null,2))}`)}m.success("Screenshot captured")}catch(s){console.error("Screenshot failed:",s),m.error("Screenshot capture failed")}},E=async()=>{console.log("Database Connection [attempt]: Manual connection test initiated from debug page");try{await S.refetch(),m.success("Connection test completed")}catch(s){console.error("Database Connection [failure]: Manual connection test failed",s),m.error("Connection test failed")}},M=()=>{v([]),m.success("Logs cleared")},A=s=>{switch(s){case"success":return e.jsx(z,{className:"h-5 w-5 text-green-500"});case"warning":return e.jsx(Q,{className:"h-5 w-5 text-yellow-500"});case"error":return e.jsx(K,{className:"h-5 w-5 text-red-500"});case"info":return e.jsx(w,{className:"h-5 w-5 text-blue-500"});default:return e.jsx(w,{className:"h-5 w-5 text-gray-500"})}},T=s=>{switch(s){case"success":return"border-green-200 bg-green-50";case"warning":return"border-yellow-200 bg-yellow-50";case"error":return"border-red-200 bg-red-50";case"info":return"border-blue-200 bg-blue-50";default:return"border-gray-200 bg-gray-50"}};return e.jsx(U,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-indigo-600 rounded-xl p-6 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Debug Screenshot Tool"}),e.jsx("p",{className:"text-purple-100",children:"Comprehensive system testing and screenshot capture for debugging"})]}),e.jsx(Y,{className:"h-12 w-12 text-purple-200"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("button",{onClick:L,disabled:y,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center space-x-2 disabled:opacity-50",children:y?e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:"Running Tests..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("span",{children:"Run System Checks"})]})}),e.jsxs("button",{onClick:F,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",children:[e.jsx(ee,{className:"h-5 w-5"}),e.jsx("span",{children:"Take Screenshot"})]}),e.jsxs("button",{onClick:E,className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",children:[e.jsx(q,{className:"h-5 w-5"}),e.jsx("span",{children:"Test Connection"})]}),e.jsxs("button",{onClick:M,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 rounded-lg font-medium flex items-center justify-center space-x-2",children:[e.jsx(H,{className:"h-5 w-5"}),e.jsx("span",{children:"Clear Logs"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"System Checks"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[p.length," checks performed"]})]}),e.jsx("div",{className:"space-y-3",children:p.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:'No system checks performed yet. Click "Run System Checks" to start.'}):p.map((s,t)=>e.jsx("div",{className:`p-3 rounded-lg border ${T(s.status)}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[A(s.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.name}),e.jsx("span",{className:"text-xs text-gray-500",children:s.timestamp.toLocaleTimeString()})]}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:s.message}),s.details&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:s.details})]})]})},t))})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Connection Logs"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[f.length," log entries"]})]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg p-4 max-h-80 overflow-y-auto",children:f.length===0?e.jsx("p",{className:"text-gray-400 text-sm",children:"No connection logs captured yet. Connection events will appear here."}):e.jsx("div",{className:"space-y-1",children:f.map((s,t)=>e.jsx("div",{className:"text-xs font-mono",children:e.jsx("span",{className:`${s.includes("[ERROR]")?"text-red-400":s.includes("[WARN]")?"text-yellow-400":s.includes("[INFO]")?"text-blue-400":"text-green-400"}`,children:s})},t))})})]})]}),h&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Screenshot Capture"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["Captured at ",new Date().toLocaleString()]})]})]}),h.startsWith("data:image/")?e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:e.jsx("img",{src:h,alt:"Page Screenshot",className:"w-full h-auto max-h-96 object-contain"})}):e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Screenshot Information"}),e.jsx("pre",{className:"text-xs text-gray-600 whitespace-pre-wrap",children:atob(h.split(",")[1])})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"Current State Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Authentication"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",o?"Authenticated":"Not authenticated"]}),i&&e.jsxs("p",{className:"text-sm text-gray-600",children:["User: ",i.email]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Database"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Status: ",x?"Connected":"Disconnected"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Connection: ",b]}),g&&e.jsxs("p",{className:"text-sm text-red-600 mt-1",children:["Error: ",g]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:"Company"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Selected: ",d||"None"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Trial Balance: ",C.data?.length||0," entries"]})]})]})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(w,{className:"h-6 w-6 text-yellow-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-yellow-800 mb-2",children:"Debug Information"}),e.jsxs("div",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("p",{children:"• This page provides comprehensive debugging tools for the financial automation system"}),e.jsx("p",{children:"• System checks verify authentication, database connectivity, and data availability"}),e.jsx("p",{children:"• Connection logs show real-time database connection events with timestamps"}),e.jsx("p",{children:"• Screenshots can be captured for visual debugging and issue reporting"}),e.jsx("p",{children:"• All client-side console logs are automatically forwarded to the server for analysis"}),e.jsx("p",{children:"• The system includes automatic reconnection with exponential backoff for database failures"})]})]})]})})]})})}export{de as component};
