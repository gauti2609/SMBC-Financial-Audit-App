import{u as L,r as y,z as c,o as q,j as e,n as d,s as I}from"./index-HyfZDTXf.js";import{u as M,L as R,g as V,d as $,n as k}from"./Layout-tNQcTW0Y.js";import{u as f,a as z,b as Q}from"./zod-DIWepabP.js";const H=q({assetClass:I().min(1,"Asset class is required"),openingGrossBlock:d().default(0),additions:d().default(0),disposalsGross:d().default(0),openingAccDepreciation:d().default(0),depreciationForYear:d().default(0),accDeprOnDisposals:d().default(0)});function Z(){const m=L(),[j,u]=y.useState(!1),[F,p]=y.useState(!1),[N,n]=y.useState(0),o=M(m.getPPEScheduleEntries.queryOptions()),g=f({...m.addPPEScheduleEntry.mutationOptions(),onSuccess:()=>{c.success("PPE schedule entry added successfully!"),o.refetch(),u(!1),w()},onError:s=>{c.error("Failed to add entry: "+s.message)}}),E=f({...m.getPPEUploadUrl.mutationOptions(),onError:s=>{c.error("Failed to get upload URL: "+s.message),p(!1)}}),P=f({...m.processPPEFile.mutationOptions(),onSuccess:s=>{c.success(`Successfully uploaded ${s.entriesProcessed} PPE schedule entries!`),o.refetch(),p(!1),n(0)},onError:s=>{c.error("Failed to process file: "+s.message),p(!1),n(0)}}),{register:l,handleSubmit:C,reset:w,formState:{errors:v},watch:G}=z({resolver:Q(H),defaultValues:{openingGrossBlock:0,additions:0,disposalsGross:0,openingAccDepreciation:0,depreciationForYear:0,accDeprOnDisposals:0}}),a=G(),S=async s=>{try{await g.mutateAsync(s)}catch{}},B=()=>{[{assetClass:"Land",openingGrossBlock:5e6,additions:0,disposalsGross:0,openingAccDepreciation:0,depreciationForYear:0,accDeprOnDisposals:0},{assetClass:"Buildings",openingGrossBlock:15e6,additions:2e6,disposalsGross:0,openingAccDepreciation:3e6,depreciationForYear:85e4,accDeprOnDisposals:0},{assetClass:"Plant and Machinery",openingGrossBlock:25e6,additions:5e6,disposalsGross:1e6,openingAccDepreciation:8e6,depreciationForYear:24e5,accDeprOnDisposals:8e5},{assetClass:"Furniture and Fixtures",openingGrossBlock:2e6,additions:3e5,disposalsGross:1e5,openingAccDepreciation:8e5,depreciationForYear:23e4,accDeprOnDisposals:8e4},{assetClass:"Vehicles",openingGrossBlock:3e6,additions:5e5,disposalsGross:2e5,openingAccDepreciation:12e5,depreciationForYear:42e4,accDeprOnDisposals:16e4}].forEach(async t=>{try{await g.mutateAsync(t)}catch(i){console.error("Failed to add sample data:",i)}})},D=async s=>{if(!s)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(s.type)){c.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}p(!0),n(10);try{const{uploadUrl:i,objectName:x}=await E.mutateAsync({fileName:s.name,fileType:s.type});if(n(30),!(await fetch(i,{method:"PUT",body:s,headers:{"Content-Type":s.type}})).ok)throw new Error("Failed to upload file");n(60),await P.mutateAsync({objectName:x}),n(100)}catch(i){console.error("Upload error:",i),p(!1),n(0)}},O=s=>{s.preventDefault(),s.stopPropagation()},Y=s=>{s.preventDefault(),s.stopPropagation();const t=Array.from(s.dataTransfer.files);t.length>0&&D(t[0])},U=s=>{const t=Array.from(s.target.files||[]);t.length>0&&D(t[0])},r=s=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),h=s=>s.openingGrossBlock+s.additions-s.disposalsGross,b=s=>s.openingAccDepreciation+s.depreciationForYear-s.accDeprOnDisposals,A=(s,t)=>s-t,T=["Land","Buildings","Plant and Machinery","Furniture and Fixtures","Vehicles","Office Equipment","Computer Equipment","Electrical Equipment","Laboratory Equipment","Leasehold Improvements"];return e.jsx(R,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"PPE Schedule"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Property, Plant & Equipment schedule as per AS 10 and Schedule III"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:B,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>u(!j),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(V,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Entry"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),F?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${N}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[N,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:O,onDrop:Y,onClick:()=>document.getElementById("ppe-file-upload")?.click(),children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"ppe-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:U})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Asset Class, Opening Gross Block, Additions, Disposals, Opening Acc Depreciation, Depreciation for Year, Acc Depr on Disposals"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(k,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Asset Classes"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"G"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:r(o.data?.reduce((s,t)=>s+h(t),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gross Block"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-red-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"D"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:r(o.data?.reduce((s,t)=>s+b(t),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Acc. Depreciation"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"N"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:r(o.data?.reduce((s,t)=>{const i=h(t),x=b(t);return s+A(i,x)},0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Net Block"})]})})]})})]}),j&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New PPE Schedule Entry"}),e.jsxs("form",{onSubmit:C(S),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Asset Class *"}),e.jsxs("select",{...l("assetClass"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Select asset class"}),T.map(s=>e.jsx("option",{value:s,children:s},s))]}),v.assetClass&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:v.assetClass.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Gross Block"}),e.jsx("input",{...l("openingGrossBlock",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Additions"}),e.jsx("input",{...l("additions",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Disposals (Gross)"}),e.jsx("input",{...l("disposalsGross",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Opening Acc. Depreciation"}),e.jsx("input",{...l("openingAccDepreciation",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Depreciation for Year"}),e.jsx("input",{...l("depreciationForYear",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Acc. Depr. on Disposals"}),e.jsx("input",{...l("accDeprOnDisposals",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Closing Gross Block: ",e.jsxs("strong",{children:["₹",r((a.openingGrossBlock||0)+(a.additions||0)-(a.disposalsGross||0))]})]}),e.jsxs("div",{children:["Closing Acc. Depreciation: ",e.jsxs("strong",{children:["₹",r((a.openingAccDepreciation||0)+(a.depreciationForYear||0)-(a.accDeprOnDisposals||0))]})]}),e.jsxs("div",{children:["Net Block: ",e.jsxs("strong",{children:["₹",r((a.openingGrossBlock||0)+(a.additions||0)-(a.disposalsGross||0)-((a.openingAccDepreciation||0)+(a.depreciationForYear||0)-(a.accDeprOnDisposals||0)))]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{type:"button",onClick:()=>{u(!1),w()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:g.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:g.isPending?"Adding...":"Add Entry"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"PPE Schedule Entries"})}),o.data&&o.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Asset Class"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Opening Gross"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Additions"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Disposals"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Closing Gross"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Opening Acc. Depr."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Depr. for Year"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Closing Acc. Depr."}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Net Block"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:o.data.map(s=>{const t=h(s),i=b(s),x=A(t,i);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:s.assetClass})}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",r(Number(s.openingGrossBlock))]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",r(Number(s.additions))]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",r(Number(s.disposalsGross))]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right",children:["₹",r(t)]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",r(Number(s.openingAccDepreciation))]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",r(Number(s.depreciationForYear))]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-right",children:["₹",r(i)]}),e.jsxs("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-bold text-indigo-600 text-right",children:["₹",r(x)]})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No PPE schedule data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add entries manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>u(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Entry"})]})]})]})})}export{Z as component};
