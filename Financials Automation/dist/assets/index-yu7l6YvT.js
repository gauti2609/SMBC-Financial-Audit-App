import{u as k,r as p,z as i,o as T,j as e,e as U,n as j,s as O}from"./index-HyfZDTXf.js";import{u as L,L as M,g as R,d as I,t as N}from"./Layout-tNQcTW0Y.js";import{u as g,a as $,b as W}from"./zod-DIWepabP.js";const q=T({particulars:O().min(1,"Particulars is required"),currentYear:j().default(0),previousYear:j().default(0),category:U(["Defined Contribution","Defined Benefit"])});function H(){const d=k(),[h,c]=p.useState(!1),[v,o]=p.useState(!1),[f,a]=p.useState(0),r=L(d.getEmployeeBenefitEntries.queryOptions()),m=g({...d.addEmployeeBenefitEntry.mutationOptions(),onSuccess:()=>{i.success("Employee benefit entry added successfully!"),r.refetch(),c(!1),b()},onError:t=>{i.error("Failed to add entry: "+t.message)}}),w=g({...d.getEmployeeBenefitsUploadUrl.mutationOptions(),onError:t=>{i.error("Failed to get upload URL: "+t.message),o(!1)}}),C=g({...d.processEmployeeBenefitsFile.mutationOptions(),onSuccess:t=>{i.success(`Successfully uploaded ${t.entriesProcessed} employee benefit entries!`),r.refetch(),o(!1),a(0)},onError:t=>{i.error("Failed to process file: "+t.message),o(!1),a(0)}}),{register:x,handleSubmit:D,reset:b,formState:{errors:u}}=$({resolver:W(q),defaultValues:{currentYear:0,previousYear:0,category:"Defined Contribution"}}),E=async t=>{try{await m.mutateAsync(t)}catch{}},Y=()=>{[{particulars:"Salaries and Wages",currentYear:125e5,previousYear:118e5,category:"Defined Contribution"},{particulars:"Contribution to Provident Fund",currentYear:12e5,previousYear:115e4,category:"Defined Contribution"},{particulars:"Contribution to ESI",currentYear:28e4,previousYear:265e3,category:"Defined Contribution"},{particulars:"Gratuity Provision",currentYear:85e4,previousYear:78e4,category:"Defined Benefit"},{particulars:"Leave Encashment",currentYear:45e4,previousYear:42e4,category:"Defined Benefit"},{particulars:"Medical Benefits",currentYear:32e4,previousYear:3e5,category:"Defined Contribution"},{particulars:"Staff Welfare Expenses",currentYear:18e4,previousYear:165e3,category:"Defined Contribution"}].forEach(async s=>{try{await m.mutateAsync(s)}catch(l){console.error("Failed to add sample data:",l)}})},y=async t=>{if(!t)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(t.type)){i.error("Please upload a valid Excel (.xlsx, .xls) or CSV file");return}o(!0),a(10);try{const{uploadUrl:l,objectName:A}=await w.mutateAsync({fileName:t.name,fileType:t.type});if(a(30),!(await fetch(l,{method:"PUT",body:t,headers:{"Content-Type":t.type}})).ok)throw new Error("Failed to upload file");a(60),await C.mutateAsync({objectName:A}),a(100)}catch(l){console.error("Upload error:",l),o(!1),a(0)}},F=t=>{t.preventDefault(),t.stopPropagation()},B=t=>{t.preventDefault(),t.stopPropagation();const s=Array.from(t.dataTransfer.files);s.length>0&&y(s[0])},S=t=>{const s=Array.from(t.target.files||[]);s.length>0&&y(s[0])},n=t=>new Intl.NumberFormat("en-IN",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),P=["Salaries and Wages","Contribution to Provident Fund","Contribution to ESI","Contribution to Pension Fund","Gratuity Provision","Leave Encashment","Medical Benefits","Staff Welfare Expenses","Bonus and Incentives","Directors' Remuneration","Contract Labour Charges","Training and Development","Recruitment Expenses","Other Employee Benefits"];return e.jsx(M,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",style:{fontFamily:"Bookman Old Style, serif"},children:"Employee Benefits Schedule"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Manage employee benefit expenses as per AS 15 requirements"})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:Y,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Load Sample Data"}),e.jsxs("button",{onClick:()=>c(!h),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center space-x-2",children:[e.jsx(R,{className:"h-5 w-5"}),e.jsx("span",{children:"Add Entry"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Upload Excel File"}),v?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Processing file..."}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full transition-all duration-300",style:{width:`${f}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[f,"% complete"]})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-indigo-400 transition-colors cursor-pointer",onDragOver:F,onDrop:B,onClick:()=>document.getElementById("employee-benefits-file-upload")?.click(),children:[e.jsx(I,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Drag and drop your Excel file here, or"}),e.jsx("button",{className:"text-indigo-600 hover:text-indigo-700 font-medium",children:"browse to upload"}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Supports .xlsx, .xls and .csv files"}),e.jsx("input",{id:"employee-benefits-file-upload",type:"file",className:"hidden",accept:".xlsx,.xls,.csv",onChange:S})]}),e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Expected Format:"}),e.jsx("p",{className:"text-xs text-blue-700",children:"Columns: Particulars, Current Year, Previous Year, Category (Defined Contribution/Defined Benefit)"})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:r.data?.length||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Benefit Types"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"₹"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.reduce((t,s)=>t+Number(s.currentYear),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total (CY)"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"DC"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.filter(t=>t.category==="Defined Contribution").reduce((t,s)=>t+Number(s.currentYear),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Defined Contribution"})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 bg-indigo-500 rounded-full mx-auto mb-2 flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-sm",children:"DB"})}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:n(r.data?.filter(t=>t.category==="Defined Benefit").reduce((t,s)=>t+Number(s.currentYear),0)||0)}),e.jsx("p",{className:"text-sm text-gray-600",children:"Defined Benefit"})]})})]})})]}),h&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add New Employee Benefit Entry"}),e.jsxs("form",{onSubmit:D(E),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Particulars *"}),e.jsx("input",{...x("particulars"),list:"benefit-options",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter benefit details"}),e.jsx("datalist",{id:"benefit-options",children:P.map(t=>e.jsx("option",{value:t},t))}),u.particulars&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.particulars.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),e.jsxs("select",{...x("category"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"Defined Contribution",children:"Defined Contribution"}),e.jsx("option",{value:"Defined Benefit",children:"Defined Benefit"})]}),u.category&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:u.category.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Current Year)"}),e.jsx("input",{...x("currentYear",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Amount (Previous Year)"}),e.jsx("input",{...x("previousYear",{valueAsNumber:!0}),type:"number",step:"0.01",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),b()},className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:m.isPending,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors disabled:opacity-50",children:m.isPending?"Adding...":"Add Entry"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Employee Benefit Entries"})}),r.data&&r.data.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Particulars"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Category"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Current Year"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Previous Year"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Change"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.data.map(t=>{const s=Number(t.currentYear)-Number(t.previousYear);return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.particulars})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${t.category==="Defined Contribution"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:t.category})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",n(Number(t.currentYear))]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 text-right",children:["₹",n(Number(t.previousYear))]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-right",children:e.jsxs("span",{className:s>=0?"text-green-600":"text-red-600",children:[s>=0?"+":"","₹",n(Math.abs(s))]})})]},t.id)})})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No employee benefit data"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Add entries manually or upload an Excel file to get started."}),e.jsx("button",{onClick:()=>c(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:"Add First Entry"})]})]})]})})}export{H as component};
